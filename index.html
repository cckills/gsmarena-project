
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مواصفات الهواتف </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding:20px; background:#f5f8ff; }
    .brand { font-weight:700; color:#0d6efd; }
    #results .result-item { cursor:pointer; border-bottom:1px solid #e9eefb; padding:10px 0; }
    #results .result-item:hover { background:#eef5ff; }
    .phone-thumb { width:64px; height:64px; object-fit:contain; }
    .specs-container { max-height:60vh; overflow:auto; }

.loader-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}
/* 🌐 عرض شبكي جميل */
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
}

.results-grid .result-item {
  background: #fff;
  border: 1px solid #e1e8ff;
  border-radius: 16px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.results-grid .result-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.results-grid .result-item img {
  width: 90px;
  height: 90px;
  object-fit: contain;
  margin-bottom: 10px;
}

.results-grid .result-item .fw-bold {
  color: #0d6efd;
  font-size: 1rem;
}

/* 📋 عرض قائم (افتراضي) */
.results-list .result-item {
  cursor: pointer;
  border-bottom: 1px solid #e9eefb;
  padding: 10px 0;
}

.results-list .result-item:hover {
  background: #eef5ff;
}

/* تحسين بسيط لزر عرض شبكي */
#toggleView {
  transition: all 0.2s ease;
}

#toggleView:hover {
  transform: scale(1.05);
}

/* ✅ تنسيقات النتائج */
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 1rem;
  padding: 1rem;
}
.results-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 1rem;
}

/* 🧩 بطاقة الهاتف */
.result-item {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  transition: all 0.25s ease;
  cursor: pointer;
  overflow: hidden;
  text-align: center;
  padding: 1rem;
}
.result-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* 📱 الصورة */
.phone-thumb {
  width: 100%;
  height: 150px;
  object-fit: contain;
  border-radius: 10px;
  background: #f8f9fa;
}

/* 🧾 نصوص البطاقة */
.result-item .fw-bold {
  font-size: 0.95rem;
  color: #333;
}
.result-item .text-muted {
  font-size: 0.8rem;
  color: #777;
}

/* 🧭 الزر داخل القائمة */
.result-item button {
  border-radius: 10px;
}

/* 🌙 دعم الوضع الليلي (اختياري) */
@media (prefers-color-scheme: dark) {
  .result-item {
    background: #222;
    color: #eee;
  }
  .result-item .text-muted {
    color: #aaa;
  }
  .phone-thumb {
    background: #333;
  }
}

/* 🎨 تحسين عرض المودال */
#specModal .modal-content {
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 6px 25px rgba(0,0,0,0.2);
  background: #fff;
}

#specModal .modal-header {
  background: linear-gradient(135deg, #007bff, #6610f2);
  color: #fff;
  border-bottom: none;
}

#specModal .modal-title {
  font-weight: 700;
  font-size: 1.3rem;
}

#specModal .modal-body {
  background: #f9fafb;
  padding: 2rem;
  border-radius: 0 0 18px 18px;
}

/* 📱 الصورة */
#specModal img {
  max-width: 100%;
  border-radius: 12px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* 🧩 الجداول */
#specModal table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1.5rem;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 5px rgba(0,0,0,0.05);
}

#specModal th {
  background: #f1f3f5;
  color: #333;
  text-align: left;
  width: 140px;
  font-weight: 600;
  padding: 10px 12px;
  border-right: 1px solid #e0e0e0;
  vertical-align: top;
}

#specModal td {
  padding: 10px 12px;
  font-size: 0.92rem;
  color: #555;
  border-bottom: 1px solid #f0f0f0;
}

#specModal tr:last-child td {
  border-bottom: none;
}

/* 🧭 الأقسام */
#specModal th[rowspan] {
  background: #e9ecef;
  color: #222;
  font-size: 0.95rem;
  border-right: 2px solid #dee2e6;
}

/* 💡 تحسين النصوص */
#specModal h1,
#specModal h2 {
  font-size: 1.1rem;
  margin: 1.5rem 0 1rem;
  color: #333;
  border-bottom: 2px solid #007bff;
  display: inline-block;
  padding-bottom: 4px;
}

#specModal p {
  font-size: 0.9rem;
  color: #666;
}

/* 🌙 الوضع الليلي */
@media (prefers-color-scheme: dark) {
  #specModal .modal-content { background: #222; color: #eee; }
  #specModal .modal-header { background: linear-gradient(135deg, #444, #222); }
  #specModal th { background: #333; color: #ddd; border-right-color: #444; }
  #specModal td { border-bottom-color: #333; color: #ccc; }
  #specModal table { background: #2a2a2a; box-shadow: 0 1px 5px rgba(255,255,255,0.05); }
}
  </style>
</head>
<body>
  <div class="container">
    <header class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center">
        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect rx='8' width='100%' height='100%' fill='%230d6efd'/><text x='50%' y='55%' fill='white' font-size='18' font-family='Arial' text-anchor='middle' dominant-baseline='middle'>PS</text></svg>" alt="logo" class="me-2">
        <div>
          <div class="brand">مواصفات الهواتف</div>
          <div class="text-muted small">Phone Specs</div>
        </div>
      </div>

      <div>
        <select id="langToggle" class="form-select form-select-sm">
          <option value="ar">العربية</option>
          <option value="en">English</option>
        </select>
      </div>
    </header>

    <div class="card mb-3">
      <div class="card-body">
        <div class="row g-2">
          <div class="col-12 col-md-9">
            <input id="query" class="form-control" placeholder="ابحث عن هاتف (مثال: Huawei Y9 Prime 2019)" />
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button id="searchBtn" class="btn btn-primary">بحث</button>
          </div>
        </div>
        <div class="form-text mt-2" id="hint">يمكنك البحث عن اسم الهاتف بالكامل أو جزء منه.</div>
      </div>
    </div>

    <div class="card p-3 mb-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="fw-bold">نتائج البحث</div>
    <div>
      <button id="toggleView" class="btn btn-outline-secondary btn-sm">عرض شبكي</button>
    </div>
  </div>
  <div id="results" class="results-list"></div>
</div>


    <footer class="text-center text-muted small">
      <div id="footerText">مبني على بيانات عبدالعليم </div>
    </footer>
  </div>

 <!-- 📱 Modal: تفاصيل الهاتف -->
<div class="modal fade" id="specModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalTitle">تفاصيل الهاتف</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- ✅ تبويبات المواصفات -->
        <ul class="nav nav-tabs" id="specTabs" role="tablist">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-overview" type="button">📄 نظرة عامة</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-network" type="button">📶 الشبكة</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-display" type="button">📱 الشاشة</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-camera" type="button">📷 الكاميرا</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-hardware" type="button">⚙️ العتاد</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-battery" type="button">🔋 البطارية</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-other" type="button">🧩 أخرى</button></li>
        </ul>

        <!-- ✅ محتوى التبويبات -->
        <div class="tab-content mt-3" id="modalTabsContent">
          <div class="tab-pane fade show active" id="tab-overview"></div>
          <div class="tab-pane fade" id="tab-network"></div>
          <div class="tab-pane fade" id="tab-display"></div>
          <div class="tab-pane fade" id="tab-camera"></div>
          <div class="tab-pane fade" id="tab-hardware"></div>
          <div class="tab-pane fade" id="tab-battery"></div>
          <div class="tab-pane fade" id="tab-other"></div>
        </div>
      </div>
    </div>
  </div>
</div>


 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const lang = { current: 'ar' };
const langTexts = {
  ar: {
    searchPlaceholder: 'ابحث عن هاتف (مثال: Huawei Y9 Prime 2019)',
    searchBtn: 'بحث',
    hint: 'يمكنك البحث عن اسم الهاتف بالكامل أو جزء منه.',
    noResults: 'لا توجد نتائج.',
    builtOn: 'مبني على بيانات GSMArena',
    detailsTitle: 'تفاصيل الهاتف'
  },
  en: {
    searchPlaceholder: 'Search phone (e.g. Huawei Y9 Prime 2019)',
    searchBtn: 'Search',
    hint: 'You can search full or partial phone name.',
    noResults: 'No results.',
    builtOn: 'Built on GSMArena data',
    detailsTitle: 'Phone details'
  }
};

const modalEl = new bootstrap.Modal(document.getElementById('specModal'), { backdrop: 'static', keyboard: false });
const resultsEl = document.getElementById('results');
const queryEl = document.getElementById('query');

let isGrid = localStorage.getItem('viewMode') === 'grid';
const toggleBtn = document.getElementById('toggleView');

function applyViewMode() {
  resultsEl.className = isGrid ? 'results-grid' : 'results-list';
  toggleBtn.textContent = isGrid ? 'عرض قائم' : 'عرض شبكي';
  if (window.currentResults) renderResults(window.currentResults);
}
applyViewMode();

toggleBtn.addEventListener('click', () => {
  isGrid = !isGrid;
  localStorage.setItem('viewMode', isGrid ? 'grid' : 'list');
  applyViewMode();
});

document.getElementById('langToggle').addEventListener('change', (e) => {
  lang.current = e.target.value;
  applyLang();
});

function applyLang() {
  const t = langTexts[lang.current];
  queryEl.placeholder = t.searchPlaceholder;
  document.getElementById('searchBtn').textContent = t.searchBtn;
  document.getElementById('hint').textContent = t.hint;
  document.getElementById('footerText').textContent = t.builtOn;
  document.getElementById('modalTitle').textContent = t.detailsTitle;
}
applyLang();

document.getElementById('searchBtn').addEventListener('click', doSearch);
queryEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') doSearch(); });
function showLoader(text = "جاري التحميل...") {
  document.getElementById("loaderText").textContent = text;
  document.getElementById("loader").style.display = "flex";
}

function hideLoader() {
  document.getElementById("loader").style.display = "none";
}

async function doSearch() {
  let q = queryEl.value.trim();
  if (!q) return;
  showLoader("جاري البحث عن الهاتف..."); // إظهار الـ loader
  try {
    const hasArabic = /[\u0600-\u06FF]/.test(q);
    if (hasArabic && lang.current === 'en') q = await translateToEnglish(q);

    const resp = await fetch('/api/search?name=' + encodeURIComponent(q));
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const data = await resp.json();
    renderResults(data);
  } catch (err) {
    resultsEl.innerHTML = '<div class="text-danger text-center py-3">خطأ: ' + err.message + '</div>';
  } finally {
    hideLoader(); // إخفاء الـ loader بعد الانتهاء
  }
}

function renderResults(items) {
  window.currentResults = items;
  const t = langTexts[lang.current];
  if (!items || items.length === 0) {
    resultsEl.innerHTML = `<div class="text-center text-muted py-3">${t.noResults}</div>`;
    return;
  }
  resultsEl.innerHTML = '';
  items.forEach(it => {
    const div = document.createElement('div');
    div.className = isGrid ? 'result-item' : 'result-item d-flex align-items-center';
    div.innerHTML = isGrid
      ? `<img src="${it.thumb || ''}" class="phone-thumb mb-2"><div class="fw-bold">${it.title}</div><div class="text-muted small">${it.subtitle || ''}</div>`
      : `<img src="${it.thumb || ''}" class="phone-thumb me-3"><div class="flex-grow-1"><div class="fw-bold">${it.title}</div><div class="text-muted small">${it.subtitle || ''}</div></div><div><button class="btn btn-outline-primary btn-sm">عرض</button></div>`;
    div.addEventListener('click', () => openPhone(it.path, it.title));
    resultsEl.appendChild(div);
  });
}

async function openPhone(path, title) {
  try {
    const resp = await fetch('/api/phone?path=' + encodeURIComponent(path));
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const html = await resp.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const tables = Array.from(doc.querySelectorAll('table'));
    document.querySelectorAll('#modalTabsContent .tab-pane').forEach(tab => tab.innerHTML = '');
    const imgSrc = doc.querySelector('img')?.src || '';
    const overviewEl = document.querySelector('#tab-overview');

    overviewEl.innerHTML = `
      <div class="card mb-3 shadow-sm border-0 rounded-4">
        <div class="row g-0 align-items-center">
          <div class="col-md-4 text-center p-3">
            <img src="${imgSrc}" class="img-fluid rounded-3" style="max-height: 250px; object-fit: contain;" alt="${title}">
          </div>
          <div class="col-md-8 p-3">
            <h4 class="fw-bold mb-3">${title}</h4>
            <p class="text-muted mb-3">المواصفات التقنية من GSMArena</p>
            <hr>
            <div class="row g-2" id="spec-cards"></div>
          </div>
        </div>
      </div>
    `;

    let yearText = '—', osText = '—', chipText = '—', cpuText = '—', gpuText = '—', memText = '—';

    // استخراج كل القيم بذكاء من كل النصوص
    tables.forEach(tbl => {
      const rows = Array.from(tbl.querySelectorAll('tr'));
      rows.forEach(row => {
        const th = row.querySelector('th')?.innerText?.toLowerCase() || '';
        const td = row.querySelector('td')?.innerText?.trim() || '';

        // سنة الإصدار
        if ((th.includes('announced') || th.includes('launch')) && td) {
          const match = td.match(/\d{4}/);
          if (match) yearText = match[0];
          else yearText = td;
        }

        // نظام التشغيل
        if (th.includes('os') && td) osText = td;

        // المعالج / الشريحة
        if (th.includes('chipset') && td) chipText = td;

        // CPU
        if (th.includes('cpu') && td) cpuText = td;
        else if (td.toLowerCase().includes('octa-core') || td.toLowerCase().includes('quad-core')) cpuText = td;

        // GPU
        if (th.includes('gpu') && td) gpuText = td;
        else if (td.toLowerCase().includes('mali') || td.toLowerCase().includes('adreno')) gpuText = td;

        // الذاكرة الداخلية
        if ((th.includes('internal') || th.includes('memory')) && td) memText = td;
      });
    });

    // تأكيد القيم من data-spec إذا وجدت
    if (doc.querySelector('[data-spec="chipset"]')) chipText = doc.querySelector('[data-spec="chipset"]').innerText.trim();
    if (doc.querySelector('[data-spec="cpu"]')) cpuText = doc.querySelector('[data-spec="cpu"]').innerText.trim();
    if (doc.querySelector('[data-spec="gpu"]')) gpuText = doc.querySelector('[data-spec="gpu"]').innerText.trim();
    if (doc.querySelector('[data-spec="internalmemory"]')) memText = doc.querySelector('[data-spec="internalmemory"]').innerText.trim();

    const colors = ['#e0f7fa', '#ffe0b2', '#f3e5f5', '#c8e6c9', '#fff9c4', '#ffccbc'];
    const specs = [
      { icon: '📅', name: 'سنة الإصدار', value: yearText },
      { icon: '⚙️', name: 'نظام التشغيل', value: osText },
      { icon: '🧠', name: 'المعالج', value: chipText },
      { icon: '⚡', name: 'وحدة المعالجة المركزية', value: cpuText },
      { icon: '🎮', name: 'وحدة الرسوميات', value: gpuText },
      { icon: '💾', name: 'الذاكرة', value: memText }
    ];

    const specContainer = document.getElementById('spec-cards');
    specContainer.innerHTML = '';
    specs.forEach((s, i) => {
      const card = document.createElement('div');
      card.className = 'col-6 col-md-4';
      card.innerHTML = `
        <div class="card text-center p-3 shadow-sm h-100" style="background:${colors[i]}; border-radius:12px;">
          <div class="fw-bold mb-1">${s.icon} ${s.name}</div>
          <div class="text-muted small">${s.value}</div>
        </div>
      `;
      specContainer.appendChild(card);
    });

    // توزيع الجداول على التبويبات
    tables.forEach(tbl => {
      const thText = (tbl.querySelector('th')?.innerText || '').toLowerCase();
      let target = '#tab-other';
      if (thText.includes('network')) target = '#tab-network';
      else if (thText.includes('display')) target = '#tab-display';
      else if (thText.includes('camera')) target = '#tab-camera';
      else if (thText.includes('platform') || thText.includes('chipset') || thText.includes('memory')) target = '#tab-hardware';
      else if (thText.includes('battery')) target = '#tab-battery';
      else if (thText.includes('launch') || thText.includes('body')) target = '#tab-overview';
      document.querySelector(target).appendChild(tbl);
    });

    document.getElementById('modalTitle').textContent = title;
    modalEl.show();

  } catch (err) {
    alert('فشل جلب بيانات الهاتف: ' + err.message);
  }
}

async function translateToEnglish(text) {
  try {
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=ar|en`;
    const resp = await fetch(url);
    const data = await resp.json();
    return data?.responseData?.translatedText || text;
  } catch {
    return text;
  }
}


// التأكد من وجود مكتبة SweetAlert2

queryEl.addEventListener('input', async (e) => {
  const arabicPattern = /[\u0600-\u06FF]/g;
  if (arabicPattern.test(queryEl.value)) {
    queryEl.value = queryEl.value.replace(arabicPattern, ''); // إزالة الأحرف العربية

    await Swal.fire({
      title: "عفوا",
      text: "لا يمكنك إدخال اللغة العربية في مربع البحث!",
      icon: "warning",
      confirmButtonText: "حسنًا",
      allowOutsideClick: false,
      allowEscapeKey: false,
      backdrop: `rgba(0,0,0,0.6)`,
      customClass: { popup: "swal2-rounded swal2-bordered alert-shake" },
      didOpen: () => {
        const swalContainer = Swal.getPopup();
        Swal.getContainer().addEventListener("mousedown", (e) => {
          if (!swalContainer.contains(e.target)) {
            swalContainer.classList.add("shake-pulse");
            setTimeout(() => swalContainer.classList.remove("shake-pulse"), 600);
          }
        });
      }
    });
  }
});


</script>

<div id="loader" class="loader-overlay" style="display:none">
  <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
    <span class="visually-hidden">Loading...</span>
  </div>
  <div id="loaderText" class="mt-3 text-white fw-bold">جاري التحميل...</div>
</div>

</body>
</html>
