<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مواصفات الهواتف</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="icon" href="/icons/favicon.ico">
<!-- Manifest -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0d6efd">

  <style>
    /* 🌞 الوضع الفاتح */
div.fw-bold {
  color: #222 !important;
  transition: color 0.3s ease;
}
div.text-muted {
  color: #6c757d !important; /* الرمادي الافتراضي في Bootstrap */
  transition: color 0.3s ease;
}
footer.text-muted {
  color: #6c757d !important;
  transition: color 0.3s ease;
}
/* 🌙 الوضع الداكن */
body.dark-mode div.fw-bold {
  color: #f8f9fa !important;
}

body.dark-mode div.text-muted {
  color: #b0b0b0 !important;
}

body.dark-mode footer.text-muted {
  color: #b0b0b0 !important;
}

/* 📱 جميع تعديلات الهاتف مجمعة في كتلة واحدة */
@media (max-width: 576px) {

  /* شبكة النتائج */
  .results-grid {
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)) !important;
    gap: 0.4rem !important;
  }

  /* شكل عناصر النتائج */
  .result-item {
    padding: 0.5rem !important;
    border-radius: 10px !important;
  }

  /* الصور داخل النتائج */
  .result-thumb {
    width: 64px;
    height: 64px;
  }

  .phone-thumb {
    height: 120px;
  }

  /* اللودر */
  .phone {
    width: 140px;
    height: 260px;
    border-radius: 20px;
  }

  .loading-text {
    font-size: 1rem;
    margin-top: 12px;
  }

  /* زر البحث */
  #searchBtn {
    width: 100%;
    font-size: 1rem;
    padding: 10px;
  }

  #query {
    font-size: 0.95rem;
  }

  /* زر تبديل الثيم */
  #themeToggle {
    width: 44px;
    height: 44px;
    bottom: 14px;
    right: 14px;
  }
}
/* 📱 تحسين عرض بطاقات المواصفات داخل المودال على الشاشات الصغيرة */
.specs-card {
  background: rgba(var(--bs-primary-rgb), 0.1) !important;
}
body.dark-mode .specs-card .text-muted {
  color: #ccc !important;
}

@media (max-width: 576px) {
  .result-thumb {
    width: 55px !important;
    height: 55px !important;
  }

  .result-item .fw-bold {
    font-size: 0.8rem !important;
    line-height: 1.1;
  }

  .result-item .text-muted {
    font-size: 0.7rem !important;
  }
}

/* 💻 على الشاشات الكبيرة يبقى التصميم الطبيعي كما هو */
@media (min-width: 577px) {
  .results-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
  }
}
/* إدخال تجاوب لواجهة النتائج */
@media (max-width: 768px) {
  .result-item {
    padding: 0.75rem;
  }
  .result-thumb {
    width: 70px !important;
    height: 70px !important;
  }
  .results-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 0.75rem;
  }
}
/* تحسين عرض المودال على الشاشات الصغيرة */
@media (max-width: 768px) {
  .modal-dialog {
    margin: 0;
    width: 100%;
    max-width: none;
    height: 100%;
  }
  .modal-content {
    height: 100%;
    border-radius: 0 !important;
  }
  #specModal .modal-body {
    padding: 1rem;
    overflow-y: auto;
  }
  #specModal img {
    max-height: 180px !important;
  }
  .nav-tabs {
    flex-wrap: wrap;
    font-size: 0.9rem;
  }
  .nav-tabs .nav-link {
    flex: 1 0 45%;
    text-align: center;
    margin-bottom: 6px;
  }
}
/* جعل الجداول داخل المودال قابلة للتمرير */
#specModal table {
  display: block;
  width: 100%;
  overflow-x: auto;
  white-space: nowrap;
}
/* تحسين SweetAlert2 ليكون متجاوبًا */
.swal2-popup {
  font-size: 0.95rem !important;
  width: min(90%, 400px) !important;
  border-radius: 16px !important;
}
.swal2-title {
  font-size: 1.2rem !important;
}
.swal2-html-container {
  font-size: 0.95rem !important;
}
 body.loading {
    overflow: hidden;
  }
  body.loading #loader {
    opacity: 1 !important;
    visibility: visible !important;
  }
  .loader-overlay {
    position: fixed;
    inset: 0;
    background: #2aa53e6b;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.8s ease, visibility 0.8s ease;
    color: white;
    font-family: "Cairo", sans-serif;
  }

  .loader-overlay.hidden {
    opacity: 0;
    visibility: hidden;
  }

  .phone {
    width: 190px;
    height: 360px;
    border-radius: 28px;
    background: linear-gradient(145deg, #0b0b0b, #1e1e1e);
    position: relative;
    border: 3px solid rgba(100,100,100,0.3);
    box-shadow:
      0 25px 60px rgba(0,0,0,0.6),
      inset 0 0 20px rgba(255,255,255,0.05);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .phone::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,0.15) 50%, transparent 60%);
    animation: shine 3s infinite linear;
    pointer-events: none;
  }

  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .phone::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 28px;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
  }

  .speaker {
    position: absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 6px;
    background: #181818;
    border-radius: 4px;
  }

  .camera {
    position: absolute;
    top: 10px;
    right: 14px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: radial-gradient(circle, #00ffcc 0%, #003333 80%);
    box-shadow: 0 0 10px #00ffcc;
    animation: camBlink 2.5s infinite;
  }

  @keyframes camBlink {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  .battery {
    width: 60px;
    height: 100px;
    background: #111;
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    position: relative;
    overflow: hidden;
  }

  .battery::after {
    content: "";
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 6px;
    background: #333;
    border-radius: 3px;
  }

  .battery-level {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 20%;
    background: linear-gradient(to top, #00ff55, #66ff99);
    animation: fillBattery 2.5s infinite ease-in-out;
    box-shadow: 0 0 12px #00ff55;
  }

  @keyframes fillBattery {
    0% { height: 20%; }
    50% { height: 95%; }
    100% { height: 20%; }
  }

  .cable {
    position: absolute;
    bottom: -80px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 80px;
    background: linear-gradient(to bottom, #fff, #a884ff);
    box-shadow: 0 0 10px #a884ff;
  }

  .cable::before {
    content: "";
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 14px;
    height: 10px;
    background: #fff;
    border-radius: 3px;
  }

  .loading-text {
    margin-top: 20px;
    font-size: 1.2rem;
    font-weight: 500;
    letter-spacing: 1px;
    animation: fadeText 1.5s infinite ease-in-out;
  }

  @keyframes fadeText {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

   :root {
    --bg-light: #f5f8ff;
    --text-light: #000;
    --card-bg-light: #ffffff;
    --bg-dark: #0f0f11;
    --text-dark: #e1e1e1;
    --card-bg-dark: rgba(255, 255, 255, 0.03);
    --accent: #0d6efd;
   }

   body {
    padding: 20px;
    background: var(--bg-light);
    color: var(--text-light);
    transition:
     background 0.5s ease,
     color 0.5s ease;
    min-height: 100vh;
   }

   body.dark-mode {
    background: var(--bg-dark);
    color: var(--text-dark);
   }

   .brand {
    font-weight: 700;
    color: var(--accent);
   }
   .phone-thumb {
    width: 100%;
    height: 150px;
    object-fit: contain;
    border-radius: 10px;
    background: #f8f9fa;
   }
   .specs-container {
    max-height: 60vh;
    overflow: auto;
   }

   .card {
    background: var(--card-bg-light);
    transition:
     background 0.5s ease,
     color 0.5s ease,
     box-shadow 0.4s ease;
   }
   body.dark-mode .card {
    background: var(--card-bg-dark);
    box-shadow: 0 2px 10px rgba(255, 255, 255, 0.03);
   }

   /* Grid & list */
   .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
    padding: 1rem;
    transition: all 0.4s ease;
   }
   .results-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1rem;
    transition: all 0.4s ease;
   }
   .result-item {
    background: var(--card-bg-light);
    border-radius: 15px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    transition:
     transform 0.25s ease,
     background 0.4s ease;
    cursor: pointer;
    overflow: hidden;
    padding: 1rem;
    text-align: center;
   }
   body.dark-mode .result-item {
    background: var(--card-bg-dark);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.03);
   }
   .result-item.d-flex {
    display: flex;
    align-items: center;
   }
   .result-item:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
   }
   .result-thumb {
    width: 90px;
    height: 90px;
    object-fit: contain;
    margin-bottom: 10px;
    transition: filter 0.3s;
   }
   body.dark-mode .result-thumb {
    filter: brightness(0.9);
   }
   .result-item .fw-bold {
    color: var(--accent);
    font-size: 1rem;
   }
   .result-item .text-muted {
   /*  color: #6c757d;*/
    font-size: 0.85rem;
        --bs-text-opacity: 1;
    color: var(--bs-secondary-color) !important;
}

   /* Modal */
   #specModal .modal-content {
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
   }
   #specModal .modal-header {
    background: linear-gradient(135deg, #007bff, #6610f2);
    color: #fff;
    border-bottom: none;
   }
   #specModal .modal-title {
    font-weight: 700;
    font-size: 1.2rem;
   }
   #specModal .modal-body {
    background: #f9fafb;
    padding: 1.5rem;
    transition: background 0.4s ease;
   }
   body.dark-mode #specModal .modal-body {
    background: #121212;
    color: #eee;
   }
   #specModal table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    transition: background 0.4s ease;
   }
   body.dark-mode #specModal table {
    background: #1b1b1b;
    color: #ddd;
   }

   
   /* Floating theme button */
   #themeToggle {
    position: fixed;
    bottom: 20px;
    right: 20px; /* في الزاوية اليمنى كما طلبت سابقاً */
    z-index: 3000;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #0d6efd, #66a7ff);
    color: #fff;
    border: none;
    box-shadow: 0 8px 24px rgba(13, 110, 253, 0.18);
    cursor: pointer;
    transition:
     transform 0.2s ease,
     opacity 0.2s ease;
   }
   #themeToggle:hover {
    transform: scale(1.08);
   }

   /* fade transition wrapper */
   .page-fade {
    transition: opacity 0.45s ease;
   }
   .page-fade.fade-out {
    opacity: 0.35;
   }

  </style>
 </head>
 
 <body>
  <!-- ✅ اللودر الكامل -->
<div id="loader" class="loader-overlay">
  <div class="phone">
    <div class="speaker"></div>
    <div class="camera"></div>
    <div class="battery">
      <div class="battery-level"></div>
    </div>
    <div class="cable"></div>
  </div>
  <div class="loading-text">جارٍ التحميل...</div>

  <audio id="chargeSound" preload="auto">
    <source src="https://actions.google.com/sounds/v1/cartoon/siren_whistle.ogg" type="audio/ogg">
  </audio>
</div>

  <div class="container page-fade" id="pageWrapper">
   <header class="d-flex align-items-center justify-content-between mb-4">
    <div class="d-flex align-items-center">
     <img
      src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect rx='8' width='100%' height='100%' fill='%230d6efd'/><text x='50%' y='55%' fill='white' font-size='18' font-family='Arial' text-anchor='middle' dominant-baseline='middle'>PS</text></svg>"
      alt="logo"
      class="me-2"
     />
     <div>
      <div class="brand">مواصفات الهواتف</div>
      <div class="text-muted small">برمجه وتصميم عبدالعليم اسماعيل</div>
     </div>
    </div>
   </header>

  <div class="card mb-3">
  <div class="card-body">
    <div class="mb-2">
      <div class="form-text mt-2">يمكنك البحث عن اسم الهاتف بالكامل أو جزء منه.</div>
      <input list="searchHistory" id="query" class="form-control mb-2" placeholder="ابحث عن هاتف..." autocomplete="off">
      <datalist id="searchHistory"></datalist>
      <!-- الأزرار على نفس الخط -->
      <div class="d-flex gap-2">
        <button id="searchBtn" class="btn btn-primary" style="flex: 3;">
          بحث
        </button>
        <div id="clearHistoryContainer" class="text-end mt-2" style="display: none;">
        <button id="clearHistoryBtn" class="btn btn-outline-danger" style="flex: 1;">
          🗑️ مسح سجل البحث
        </button>
      </div>
    </div>
    </div>
    </div>
    </div>


   <div class="card p-3 mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
     <div class="fw-bold">نتائج البحث</div>
     <div><button id="toggleView" class="btn btn-outline-secondary btn-sm">عرض شبكي</button></div>
    </div>
    <div id="results" class="results-list"></div>
   </div>

   <footer class="text-center text-muted small mb-4">برمجه وتصميم عبدالعليم اسماعيل</footer>
  </div>

  <!-- floating theme toggle -->
  <button id="themeToggle" title="تبديل الوضع">🌙</button>

  <!-- Modal (محتوى داخل السكربت يتم ملؤه) -->
  <div
   class="modal fade"
   id="specModal"
   data-bs-backdrop="static"
   data-bs-keyboard="false"
   tabindex="-1"
   aria-hidden="true"
  >
   <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg rounded-4">
     <div class="modal-header">
      <h5 class="modal-title" id="modalTitle">تفاصيل الهاتف</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="إغلاق"></button>
     </div>
     <div class="modal-body">
      <ul class="nav nav-tabs" id="specTabs" role="tablist">
       <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-overview" type="button">
         نظرة عامة
        </button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-network" type="button">الشبكة</button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-display" type="button">الشاشة</button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-camera" type="button">الكاميرا</button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-hardware" type="button">العتاد</button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-battery" type="button">البطارية</button>
       </li>
       <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-other" type="button">أخرى</button>
       </li>
      </ul>
      <div class="tab-content mt-3" id="modalTabsContent">
       <div class="tab-pane fade show active" id="tab-overview"></div>
       <div class="tab-pane fade" id="tab-network"></div>
       <div class="tab-pane fade" id="tab-display"></div>
       <div class="tab-pane fade" id="tab-camera"></div>
       <div class="tab-pane fade" id="tab-hardware"></div>
       <div class="tab-pane fade" id="tab-battery"></div>
       <div class="tab-pane fade" id="tab-other"></div>
      </div>
     </div>
    </div>
   </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
  // جعل التنبيهات متجاوبة تلقائيًا وتظهر في المنتصف دائمًا
  Swal.mixin({
    customClass: {
      popup: 'rounded-4 shadow-lg',
      confirmButton: 'btn btn-primary mx-2',
      cancelButton: 'btn btn-secondary mx-2'
    },
    buttonsStyling: false
  });
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const loader = document.getElementById("loader");
  const chargeSound = document.getElementById("chargeSound");
// أصوات متعددة
const soundLoad = document.getElementById("soundLoad");
const soundSuccess = document.getElementById("soundSuccess");
const soundError = document.getElementById("soundError");

function playSound(audio) {
  if (!audio) return;
  audio.currentTime = 0;
  audio.play().catch(() => {});
}
 
   // Fade wrapper (لانتقال ناعم عند تبديل الثيم)
   const pageWrapper = document.getElementById("pageWrapper");
   // Theme toggle (يدوي فقط) + حفظ في localStorage
   const themeToggle = document.getElementById("themeToggle");
   const savedTheme = localStorage.getItem("theme") || "light";
   if (savedTheme === "dark") {
    document.body.classList.add("dark-mode");
    themeToggle.textContent = "☀️";
   } else {
    themeToggle.textContent = "🌙";
   }

   themeToggle.addEventListener("click", () => {
    // مؤثر تلاشي قصير
    pageWrapper.classList.add("fade-out");
    setTimeout(() => {
     document.body.classList.toggle("dark-mode");
     const isDark = document.body.classList.contains("dark-mode");
     themeToggle.textContent = isDark ? "☀️" : "🌙";
     localStorage.setItem("theme", isDark ? "dark" : "light");
     pageWrapper.classList.remove("fade-out");
    }, 180);
   });

   // Init modal
   const modalEl = new bootstrap.Modal(document.getElementById("specModal"), { backdrop: "static", keyboard: false });

   // View mode (grid/list)
   let isGrid = localStorage.getItem("viewMode") === "grid";
   const resultsEl = document.getElementById("results");
   const toggleBtn = document.getElementById("toggleView");

   function applyViewMode() {
    resultsEl.className = isGrid ? "results-grid" : "results-list";
    toggleBtn.textContent = isGrid ? "عرض قائم" : "عرض شبكي";
    if (window.currentResults) renderResults(window.currentResults);
   }
   applyViewMode();
   toggleBtn.addEventListener("click", () => {
    isGrid = !isGrid;
    localStorage.setItem("viewMode", isGrid ? "grid" : "list");
    applyViewMode();
   });
// 🧠 تحديد عنوان الـ API حسب البيئة (محلي / أونلاين)
const API_BASE =
  location.hostname === "localhost" || location.hostname === "127.0.0.1"
    ? "http://localhost:3000" // عنوان السيرفر المحلي
    : "https://gsmarena-project.vercel.app";  // <-- غيّره إلى عنوان سيرفرك الفعلي أو API المستضيف
// 🧠 حفظ سجل عمليات البحث وعرضه كمقترحات
const searchHistoryEl = document.getElementById("searchHistory");
const queryEl = document.getElementById("query");
const clearHistoryBtn = document.getElementById("clearHistoryBtn");
const clearHistoryContainer = document.getElementById("clearHistoryContainer");

// تحميل السجل عند فتح الصفحة
let searchHistory = JSON.parse(localStorage.getItem("searchHistory") || "[]");

// تحديث واجهة المستخدم بالكامل: datalist + زر المسح
function refreshSearchUI() {
  searchHistoryEl.innerHTML = searchHistory
    .map(item => `<option value="${item}">`)
    .join("");
  clearHistoryContainer.hidden = searchHistory.length === 0;

  if (searchHistory.length > 0) {
    clearHistoryContainer.style.display = "block";
  } else {
    clearHistoryContainer.style.display = "none";
  }
}
// حفظ كلمة بحث جديدة
function saveToHistory(term) {
  if (!term || searchHistory.includes(term)) return;
  searchHistory.unshift(term);
  if (searchHistory.length > 10) searchHistory.pop(); // نحتفظ بآخر 10 فقط
  localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
  refreshSearchUI();
}

// التعامل مع البحث عبر زر أو Enter
document.getElementById("searchBtn").addEventListener("click", doSearch);
queryEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter") doSearch();
});
// إخفاء المقترحات عند الضغط خارج مربع البحث
document.addEventListener("click", (e) => {
  if (e.target !== queryEl) {
    queryEl.blur();
  }
});

// زر مسح السجل
clearHistoryBtn.addEventListener("click", () => {
  Swal.fire({
    title: "تأكيد",
    text: "هل تريد مسح سجل البحث بالكامل؟",
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "نعم، احذف",
    cancelButtonText: "إلغاء",
  }).then((result) => {
    if (result.isConfirmed) {
      localStorage.removeItem("searchHistory");
      searchHistory = [];
      refreshSearchUI();
      Swal.fire({
        icon: "success",
        title: "تم الحذف بنجاح ✅",
        text: "تم مسح جميع عمليات البحث السابقة.",
        timer: 2000,
        showConfirmButton: false
      });
    }
  });
});

// تهيئة الواجهة عند تحميل الصفحة
refreshSearchUI();
    



   async function doSearch() {
    const q = queryEl.value.trim();
    if (!q) {
     await Swal.fire("ملاحظة", "الرجاء إدخال نص للبحث.", "info");
     return;
    }
    
  // 🧠 حفظ الكلمة في سجل البحث (حتى تظهر لاحقًا كمقترح)
  saveToHistory(q);
  
// عرض اللودر عند بدء البحث
  showLoader("جارٍ البحث عن الهاتف...");
      try {
     // <-- هنا طلبك الحقيقي: استبدل المسار التالي بAPI حقيقي لديك
    // const resp = await fetch("https://example.com/api/search?name=" + encodeURIComponent(q));
     const resp = await fetch(`${API_BASE}/api/search?name=${encodeURIComponent(q)}`)
     if (!resp.ok) throw new Error("خطأ في الاتصال: " + resp.status);

     const data = await resp.json();

     // 🔄 نعرض النتائج ثم ننتظر انتهاء تحميل المعالجات كلها
     await renderResults(data);
     playSound(soundSuccess); // ← صوت النجاح

    } catch (err) {
      playSound(soundError); // ← صوت الخطأ
      resultsEl.innerHTML = '<div class="text-danger text-center py-3">فشل البحث: ' + (err.message || err) + "</div>";
    } finally {
      // ✅ لا نخفي اللودر إلا بعد انتهاء كل شيء
      hideLoader();
          queryEl.blur(); // ← إخفاء قائمة المقترحات

    }

   }


   // Render results
   async function renderResults(items) {
    window.currentResults = items;
    
if (!items || items.length === 0) {
  Swal.fire({
    icon: 'info',
    title: 'لا توجد نتائج',
    text: 'عذرًا، لم يتم العثور على أي هاتف مطابق للبحث.',
    confirmButtonText: 'حسنًا',
    backdrop: `rgba(0,0,0,0.6)`
  });
  resultsEl.innerHTML = ''; // مسح أي نتائج سابقة
  return;
}
    resultsEl.innerHTML = "";

    for (const it of items) {
     const div = document.createElement("div");
     div.className = isGrid ? "result-item" : "result-item d-flex";
     const thumb = `<img src="${it.thumb || ""}" class="${isGrid ? "result-thumb" : "result-thumb me-3"}" alt="صورة">`;
     // عنصر لعرض اسم الهاتف والمعالج
     const nameChipHTML = document.createElement("div");
     nameChipHTML.className = isGrid ? "" : "flex-grow-1 ms-3";

     // افتراضيًا: اسم الجهاز فقط
     nameChipHTML.innerHTML = `<div class="fw-bold">${it.title}</div><div class="text-muted small mt-1">جاري جلب المعالج...</div>`;

     if (isGrid) {
      div.innerHTML = `${thumb}`;
      div.appendChild(nameChipHTML);
     } else {
      div.innerHTML = `${thumb}`;
      div.appendChild(nameChipHTML);
     }

     resultsEl.appendChild(div);

     // الآن fetch صغير لجلب صفحة الهاتف للحصول على Chipset
     try {
     await new Promise(r => setTimeout(r, 3000)); // ⏳ انتظر 3 ثوانٍ قبل كل طلب

      //const resp = await fetch("https://example.com/api/phone?path=" + encodeURIComponent(it.path));
const resp = await fetch(`${API_BASE}/api/phone?path=${encodeURIComponent(it.path)}`)

      if (!resp.ok) throw new Error("فشل الاتصال");
      const html = await resp.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      // البحث عن Chipset داخل صفحة العتاد
      let chipText = "—";
      const dsChip = doc.querySelector('[data-spec="chipset"], [data-spec="platform"], [data-spec="soc"]');
      if (dsChip) chipText = dsChip.innerText.trim();

      // تحديث العنصر أسفل اسم الجهاز
      nameChipHTML.innerHTML = `<div class="fw-bold">${it.title}</div>
                                <div class="text-muted small mt-1">${chipText}</div>`;
     } catch (err) {
      nameChipHTML.innerHTML = `<div class="fw-bold">${it.title}</div>
                                <div class="text-muted small mt-1">—</div>`;
     }

     // عند الضغط على النتيجة
     div.addEventListener("click", () => openPhone(it.path, it.title));
     //  return true;

    }
   }

   // Open phone - fetch details and parse
async function openPhone(path, title) {
  showLoader("جاري جلب مواصفات الهاتف...");
  playSound(soundSuccess); // 🎵 صوت عند بدء الجلب

  try {
    // ⏳ تأخير بسيط اختياري لمحاكاة التحميل
    await new Promise(r => setTimeout(r, 4000));

    const resp = await fetch(`${API_BASE}/api/phone?path=${encodeURIComponent(path)}`);
    if (!resp.ok) throw new Error("خطأ في الاتصال: " + resp.status);
    const html = await resp.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    // 🔄 تنظيف التبويبات
    document.querySelectorAll("#modalTabsContent .tab-pane").forEach((tab) => (tab.innerHTML = ""));

    // 🖼️ الصورة والعنوان
    const imgSrc = doc.querySelector("img")?.src || "";
    const overviewEl = document.getElementById("tab-overview");
    overviewEl.innerHTML = `
      <div class="card mb-3 shadow-sm border-0 rounded-4">
        <div class="row g-0 align-items-center">
          <div class="col-md-4 text-center p-3">
            <img src="${imgSrc}" class="img-fluid rounded-3" style="max-height:250px; object-fit:contain;" alt="${title}">
          </div>
          <div class="col-md-8 p-3">
            <h4 class="fw-bold mb-2">${title}</h4>
            <p class="text-muted mb-2">المواصفات التقنية</p>
            <div class="row g-2" id="spec-cards"></div>
          </div>
        </div>
      </div>
        `;

     // استخراج جداول
     const tables = Array.from(doc.querySelectorAll("table"));
     let yearText = "—",
      osText = "—",
      chipText = "—",
      cpuText = "—",
      gpuText = "—",
      memText = "—";

     // استخراج المواصفات بدقة
     tables.forEach((tbl) => {
      const rows = Array.from(tbl.querySelectorAll("tr"));
      rows.forEach((row) => {
       const th = row.querySelector("th")?.innerText?.toLowerCase() || "";
       const td = row.querySelector("td")?.innerText?.trim() || "";

       if (th.includes("os") && td) osText = td;
       if ((th.includes("announced") || th.includes("launch")) && td) {
        // استخراج السنة من النص (مثلاً: "Announced 2019, March")
        const match = td.match(/\d{4}/);
        if (match) yearText = match[0];
        else yearText = td;
       }
       if ((th.includes("chipset") || th.includes("platform") || th.includes("الشريحة")) && td) chipText = td;

       if (th.includes("cpu") && td) cpuText = td;
       if (th.includes("gpu") && td) gpuText = td;
       if ((th.includes("internal") || th.includes("memory")) && td) memText = td;
      });
     });
     // استخراج القيم من data-spec مع تغطية بدائل محتملة
     const dsChip = doc.querySelector('[data-spec="chipset"], [data-spec="platform"], [data-spec="soc"]');
     if (dsChip) chipText = dsChip.innerText.trim();

     const dsCPU = doc.querySelector('[data-spec="cpu"], [data-spec="processor"]');
     if (dsCPU) cpuText = dsCPU.innerText.trim();

     const dsGPU = doc.querySelector('[data-spec="gpu"], [data-spec="graphics"]');
     if (dsGPU) gpuText = dsGPU.innerText.trim();

     const dsMem = doc.querySelector('[data-spec="internalmemory"], [data-spec="memory"], [data-spec="storage"]');
     if (dsMem) memText = dsMem.innerText.trim();

    // const colors = ["#e0f7fa", "#ffe0b2", "#f3e5f5", "#c8e6c9", "#fff9c4", "#ffccbc"];
    const specs = [
  { icon: "📅", name: "سنة الإصدار", value: yearText },
  { icon: "⚙️", name: "نظام التشغيل", value: osText },
  { icon: "🧠", name: "المعالج / الشريحة", value: chipText },
  { icon: "⚡", name: "وحدة المعالجة المركزية", value: cpuText },
  { icon: "🎮", name: "وحدة الرسوميات", value: gpuText },
  { icon: "💾", name: "الذاكرة", value: memText },
];

const specContainer = document.getElementById("spec-cards");
specs.forEach((s) => {
  const card = document.createElement("div");
  card.className = "col-6 col-md-4";
  card.innerHTML = `
    <div class="specs-card card text-center p-3 shadow-sm h-100">
      <div class="fw-bold mb-1">${s.icon} ${s.name}</div>
      <div class="text-muted small">${s.value}</div>
    </div>
  `;
  specContainer.appendChild(card);
});


     // توزيع الجداول على التبويبات المناسبة
     tables.forEach((tbl) => {
      const headerText = (tbl.querySelector("th")?.innerText || "").toLowerCase();
      let target = "#tab-other";
      if (headerText.includes("network") || headerText.includes("gsm") || headerText.includes("lte"))
       target = "#tab-network";
      else if (headerText.includes("display") || headerText.includes("screen") || headerText.includes("size"))
       target = "#tab-display";
      else if (headerText.includes("camera") || headerText.includes("photo") || headerText.includes("video"))
       target = "#tab-camera";
      else if (headerText.includes("platform") || headerText.includes("chipset") || headerText.includes("memory"))
       target = "#tab-hardware";
      else if (headerText.includes("battery")) target = "#tab-battery";
      else if (headerText.includes("launch") || headerText.includes("body")) target = "#tab-overview";

      try {
       const clone = tbl.cloneNode(true);
       document.querySelector(target).appendChild(clone);
      } catch (e) {
       document.querySelector(target).innerHTML += tbl.outerHTML;
      }
     });


    document.getElementById("modalTitle").textContent = title;

    // ✅ إخفاء شاشة التحميل
    hideLoader();

    // ✅ تنبيه نجاح قبل إظهار المودال
    await Swal.fire({
      icon: "success",
      title: "تم تحميل المواصفات بنجاح ✅",
      text: "سيتم عرض التفاصيل الآن...",
      timer: 2000, // 2 ثانية
      timerProgressBar: true,
      showConfirmButton: false,
      background: "#ffffff",
      color: "#333",
      backdrop: "rgba(0,0,0,0.4)",
      didOpen: () => {
        Swal.getPopup().style.borderRadius = "1rem";
        Swal.getPopup().style.boxShadow = "0 0 15px rgba(0,0,0,0.2)";
      }
    });

    // ✅ عرض المودال بعد التنبيه
    modalEl.show();

  } catch (err) {
    hideLoader();
    await Swal.fire({
      icon: "error",
      title: "خطأ",
      text: "فشل جلب بيانات الهاتف: " + (err.message || err),
      confirmButtonText: "إغلاق",
      backdrop: `rgba(0,0,0,0.6)`
    });
    return;
  }
}
   // منع أي كود يَمنع إدخال العربية — لا نفعل أي قيود هنا.
   queryEl.addEventListener("input", async (e) => {
    const arabicPattern = /[\u0600-\u06FF]/g;
    if (arabicPattern.test(queryEl.value)) {
     queryEl.value = queryEl.value.replace(arabicPattern, ""); // إزالة الأحرف العربية

     await Swal.fire({
      title: "عفوا",
      text: "لا يمكنك إدخال اللغة العربية في مربع البحث!",
      icon: "warning",
      confirmButtonText: "حسنًا",
      allowOutsideClick: false,
      allowEscapeKey: false,
      backdrop: `rgba(0,0,0,0.6)`,
      customClass: { popup: "swal2-rounded swal2-bordered alert-shake" },
      didOpen: () => {
       const swalContainer = Swal.getPopup();
       Swal.getContainer().addEventListener("mousedown", (e) => {
        if (!swalContainer.contains(e.target)) {
         swalContainer.classList.add("shake-pulse");
         setTimeout(() => swalContainer.classList.remove("shake-pulse"), 600);
        }
       });
      },
     });
    }
   });


   // 🔋 عرض اللودر
function showLoader(text = "جارٍ التحميل...") {
  const loader = document.getElementById("loader");
  const chargeSound = document.getElementById("chargeSound");

  document.body.classList.add("loading");
  loader.querySelector(".loading-text").textContent = text;

  // تشغيل الصوت
  if (chargeSound) {
    chargeSound.currentTime = 0;
    chargeSound.play().catch(() => {});
  }

  loader.classList.remove("hidden");
}
// ❌ إخفاء اللودر
function hideLoader() {
  const loader = document.getElementById("loader");
  loader.classList.add("hidden");
  document.body.classList.remove("loading");
}

// ✅ عند تحميل الصفحة لأول مرة
window.addEventListener("load", async () => {
  showLoader("جارٍ التحميل...");
  setTimeout(() => hideLoader(), 2000); // يخفيه بعد ثانيتين
});
// Service Worker
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/service-worker.js")
      .then(reg => console.log("✅ تم تسجيل Service Worker:", reg.scope))
      .catch(err => console.error("❌ فشل التسجيل:", err));
  });
}

   // --- نهاية السكريبتات ---
  </script>
  <!-- أصوات متعددة -->
<audio id="soundLoad" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>
<audio id="soundSuccess" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg">
</audio>
<audio id="soundError" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

 </body>
</html>
